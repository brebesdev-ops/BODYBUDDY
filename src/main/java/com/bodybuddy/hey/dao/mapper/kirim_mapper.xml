<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.bodybuddy.hey.dao.KirimDao">

	<select id="getSecurityPwd" parameterType="String" resultType="String">
	SELECT M_PW FROM M WHERE M_ID = #{m_id}
	</select>

	<select parameterType="String" id="getMemberKind" resultType="String"> 
	SELECT M_KIND FROM M WHERE M_ID = #{m_id} 
	</select>

	<select parameterType="String" id="getNormalInfo" resultType="member"> 
	SELECT * FROM NINFO WHERE M_ID = #{m_id} 
	</select>

	<select parameterType="String" id="getTrainerInfo" resultType="member"> 
	SELECT * FROM TINFO WHERE M_ID = #{m_id} 
	</select>
	

	<select parameterType="String" id="getCompanyInfo" resultType="member"> 
	SELECT * FROM CINFO WHERE M_ID = #{m_id} 
	</select>
	
		
	<resultMap type="HashMap" id="detailPageResultMap">
		<result column="AD_CONTENT" jdbcType="NCLOB" javaType="String"/>
	</resultMap>
	
	<select parameterType="String" id="detailPage" resultType="HashMap" resultMap="detailPageResultMap"> 
		SELECT DC.*, AD.AD_CONTENT 
		FROM	(SELECT DISTINCT AD_CODE, AD_NAME, AD_TITLE, AD_STATUS, AD_DATE, AD_CATEGORY, 
				 PF_IMAGE, M_ADDR, DP.T_CID, M_NAME, M_KIND, T_CID_ADDR 
      			 FROM DETAILPAGE DP
      			 LEFT JOIN T_CID_ADDR TCA ON DP.T_CID=TCA.T_CID) DC
		LEFT JOIN AD ON DC.AD_CODE=AD.AD_CODE
		WHERE DC.AD_CODE= #{ad_code} 
	</select>
	
	<resultMap type="OpCategory" id="opCategory">
  		<result property="op_adcode" column="OP_ADCODE" />
 		<result property="op_code" column="OP_CODE" />
		<result property="op_trainer" column="OP_TRAINER"/> 
  		<result property="op_content" column="OP_CONTENT"  />
  		<result property="op_price" column="OP_PRICE" />
  		<result property="op_period" column="OP_PERIOD"/>
  		<result property="op_times" column="OP_TIMES"/>
  		<result property="op_day" column="OP_DAY"/>
  		<result property="op_clock" column="OP_CLOCK"/>
  		<result property="op_personnel" column="OP_PERSONNEL"/>
  		<result property="m_name" column="M_NAME" />
  		<result property="m_addr" column="M_ADDR"/>
  		<result property="m_exaddr" column="M_EXADDR"/>
  	</resultMap>			
	<select id="opCateList" parameterType="String" resultType="opCategory" resultMap="opCategory">
		SELECT * FROM CATEGORY WHERE OP_ADCODE = #{ad_code}
	</select>


	<insert id="dibsAdd" parameterType="HashMap">
		INSERT INTO D VALUES(#{d_adcode},#{d_id})
	</insert>
	
	<delete id="dibsDelete" parameterType="HashMap">
		DELETE FROM D WHERE D_ADCODE=#{d_adcode} AND D_ID=#{d_id}
	</delete>
	
	<insert id="purchSingle" parameterType="Payment">
		INSERT INTO PS VALUES(PS_SEQ.NEXTVAL,#{ps_adcode},#{ps_opcode},#{ps_mid},SYSDATE,#{ps_price})
	</insert>
	
	
	<select parameterType="String" id="getTrainerProfile" resultType="HashMap"> 
		SELECT M.M_ID, M.M_NAME, M.M_KIND, T.T_CID, T.T_CAREER, C.C_BNAME, PF.PF_IMAGE 
		FROM M
		LEFT JOIN T ON M.M_ID=T.T_ID
		LEFT JOIN C ON T.T_CID=C.C_ID
		LEFT JOIN PF ON M.M_ID=PF_ID
		WHERE M.M_ID=#{m_id} AND M.M_KIND='t'
	</select>
	
	<select parameterType="String" id="getTrainerProfileOption" resultType="HashMap"> 
		SELECT OP_CODE, OP_ADCODE, OP_TRAINER, OP_CATEGORY, OP_NAME, OP_PERIOD, AD_TITLE, AD_STATUS, AD_DATE, AD_KIND, 
		AD_NAME, MT.M_ADDR AS T_ADDR, MC.M_ADDR AS AD_ADDR, C_BNAME
		FROM OP
		LEFT JOIN AD ON OP_ADCODE = AD_CODE
		LEFT JOIN M MT ON OP_TRAINER=MT.M_ID
		LEFT JOIN M MC ON AD_NAME=MC.M_ID
		LEFT JOIN C ON AD_NAME=C_ID
		WHERE OP_TRAINER=#{m_id} 
	</select>
	
	<select parameterType="String" id="getCompanyProfile" resultType="HashMap"> 
		SELECT M_ID, M_NAME, M_PHONE, M_ADDR, C_NUM, C_BNAME, C_BPHONE ,PF_IMAGE FROM CINFO
		WHERE M_ID=#{m_id} 
	</select>
	
	<select parameterType="String" id="getCompanyProfileOption" resultType="HashMap"> 
		SELECT AD_CODE, AD_TITLE, AD_DATE, AD_STATUS, AD_KIND FROM AD
		WHERE AD_NAME=#{m_id} 
	</select>
	
	<select parameterType="String" id="detailQa" resultType="qna"> 
		SELECT * FROM QA
		WHERE QA_ADCODE=#{ad_code} 
	</select>
	<select parameterType="String" id="detailReview" resultType="HashMap"> 
		SELECT RV_NUM, RV_PSCODE, RV_NAME, RV_CONTENT, RV_DATE, RV_STPOINT, 
		AD_CODE, PS_DATE, OP_CODE, OP_CONTENT, OP_PERIOD, OP_TIMES, OP_DAY, OP_CLOCK 
		FROM RV
		LEFT JOIN PS ON RV.RV_PSCODE=PS.PS_CODE
		LEFT JOIN AD ON PS.PS_ADCODE=AD.AD_CODE
		LEFT JOIN OP ON PS.PS_OPCODE=OP.OP_CODE
		WHERE AD.AD_CODE = #{ad_code}
	</select>
	
		<select id="selectPscode" parameterType="HashMap" resultType="Payment">
		SELECT PS_CODE FROM PS WHERE PS_MID=#{ps_mid} AND PS_ADCODE=#{ps_adcode}
	</select>
	
	<select id="selectOverlap" parameterType="HashMap" resultType="Integer">
		SELECT COUNT(*) FROM PS WHERE PS_MID=#{ps_mid} AND PS_ADCODE=#{ps_adcode}
	</select>
	
	<insert id="insertDaliy" parameterType="Payment">
		INSERT INTO DAILY VALUES(DA_SEQ.NEXTVAL,#{ps_code},'대기중')
	</insert>
	
	
	 <select id="deleteRealIdCheck" parameterType="String" resultType="String">
  		SELECT m_id FROM DELETEREALID
  		WHERE M_ID = #{m_id}
 	</select>
	
	
	
	
	
</mapper>